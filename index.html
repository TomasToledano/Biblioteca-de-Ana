<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Buscador de Biblioteca de Ana</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { 
        font-family: Arial, sans-serif; 
        margin: 10px; 
        padding: 0; 
        display: flex;
        flex-direction: column;
        align-items: center; /* centra horizontalmente todo */
    }    

    .form-container {
        width: 50%;
    }

    label, input, button { 
        display: block; 
        width: 100%;  /* ocupa todo el ancho del contenedor */
        margin: 5px 0; 
        box-sizing: border-box; 
    }

    input { padding: 8px; }

    button { 
        padding: 10px; 
        margin-top: 10px; 
        cursor: pointer; 
        background-color: #4CAF50; 
        color: white; 
        border: none; 
        border-radius: 5px;
        transition: background-color 0.3s;
    }

    button:hover { background-color: #3e8e41; }

    table { 
        width: 50%; 
        border-collapse: collapse; 
        margin-top: 15px; 
    }

    th, td { 
        border: 1px solid #ccc; 
        padding: 8px; 
        text-align: left; 
    }

    th { background-color: #f0f0f0; }

    @media (max-width: 600px) {
        .form-container, table { width: 90%; }
        th, td { font-size: 12px; padding: 5px; }
        input, button { font-size: 14px; }
    }

    /* BOTÓN DE LEYENDA */
    #leyendaBtn {
        position: fixed;
        top: 7px;
        right: 20px;
        background-color: #007BFF;
        color: white;
        border: none;
        border-radius: 25px;
        padding: 10px 20px;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 3px 6px rgba(0,0,0,0.2);
        z-index: 1000;
        transition: background-color 0.5s;
        width: auto;
    }
        /* Ajuste para móviles */
    @media (max-width: 600px) {
        #leyendaBtn {
            top: auto;       /* quitar top fijo */
            bottom: 20px;    /* lo ponemos abajo */
            right: 20px;     
            width: 120px;    /* ancho más cómodo en móvil */
        }
    }


    #leyendaBtn:hover { background-color: #0056b3; }

    /* MODAL LEYENDA */
    #leyendaModal {
        position: fixed;
        top: 0; left: 0;
        width: 100%; height: 100%;
        background-color: rgba(0,0,0,0.5);
        z-index: 9999;
        display: none;
        overflow-y: auto;
        padding-top: 50px;
    }

    #leyendaModal div {
        background-color: #fff;
        margin: auto;
        padding: 10px 20px;
        border-radius: 12px;
        max-width: 500px;
        position: relative;
        box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        animation: fadeIn 0.3s ease-in-out;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(-20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    #cerrarLeyenda {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 24px;
        cursor: pointer;
        font-weight: bold;
        color: #333;
        transition: color 0.2s;
    }

    #cerrarLeyenda:hover { color: #007BFF; }

    #leyendaModal h3 {
        text-align: center;
        font-size: 22px;
        margin-bottom: 20px;
        color: #007BFF;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-weight: bold;
    }

    #listaLeyenda {
        list-style: none;
        padding-left: 10px;
        column-count: 2;
        column-gap: 40px;
    }

    #listaLeyenda li { margin-bottom: 8px; }
    #listaLeyenda li strong { font-size: 16px; color: #333; }
    #listaLeyenda li ul { list-style: disc; margin-left: 15px; margin-top: 4px; }
    #listaLeyenda li ul li { font-weight: normal; color: #555; font-size: 14px; margin-bottom: 3px; }

</style>
</head>
<body>

<h2>Buscador de la Biblioteca de Ana</h2>

<div class="form-container">
  <form onsubmit="buscarLibros(); return false;">
      <label>Sección:</label>
      <input type="text" id="seccion" placeholder="Ej: ARTE, MITO, NOVE...">

      <label>Subsección:</label>
      <input type="text" id="subseccion" placeholder="Ej: Romántica, Suspense...">

      <label>Autor:</label>
      <input type="text" id="autor" placeholder="Ej: Homero">

      <label>Título:</label>
      <input type="text" id="titulo" placeholder="Ej: Iliada">

      <button type="submit" id="buscarBtn">Buscar</button>
  </form>
</div>


<table id="resultados">
    <thead>
        <tr>
            <th>Referencia</th>
            <th>Título</th>
            <th>Autor</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<button id="leyendaBtn">Leyenda</button>

<div id="leyendaModal">
    <div>
        <span id="cerrarLeyenda">&times;</span>
        <h3>Secciones y Subsecciones</h3>
        <ul id="listaLeyenda"></ul>
    </div>
</div>

<script>
let biblioteca = {};

// Cargar JSON
fetch("biblioteca.json")
.then(response => response.json())
.then(data => { biblioteca = data; })
.catch(err => console.error("Error cargando biblioteca:", err));

function normalizar(texto) {
    return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[^\w\s]/gi, '');
}

function buscarLibros() {
    const secFiltro = normalizar(document.getElementById("seccion").value);
    const subFiltro = normalizar(document.getElementById("subseccion").value);
    const autorFiltro = normalizar(document.getElementById("autor").value);
    const tituloFiltro = normalizar(document.getElementById("titulo").value);

    const tbody = document.querySelector("#resultados tbody");
    tbody.innerHTML = "";

    for (let cod in biblioteca) {
        const secObj = biblioteca[cod];

        secObj.libros.forEach(libro => {
            if ((secFiltro && !normalizar(cod).includes(secFiltro)) ||
                (autorFiltro && !normalizar(libro.autor).includes(autorFiltro)) ||
                (tituloFiltro && !normalizar(libro.titulo).includes(tituloFiltro))) return;

            const fila = tbody.insertRow();
            fila.insertCell(0).innerText = libro.referencia;
            fila.insertCell(1).innerText = libro.titulo;
            fila.insertCell(2).innerText = libro.autor;
        });

        for (let sub in secObj.subsecciones) {
            secObj.subsecciones[sub].forEach(libro => {
                if ((secFiltro && !normalizar(cod).includes(secFiltro)) ||
                    (subFiltro && !normalizar(sub).includes(subFiltro)) ||
                    (autorFiltro && !normalizar(libro.autor).includes(autorFiltro)) ||
                    (tituloFiltro && !normalizar(libro.titulo).includes(tituloFiltro))) return;

                const fila = tbody.insertRow();
                fila.insertCell(0).innerText = libro.referencia;
                fila.insertCell(1).innerText = libro.titulo;
                fila.insertCell(2).innerText = libro.autor;
            });
        }
    }
}

// Leyenda
const btn = document.getElementById("leyendaBtn");
const modal = document.getElementById("leyendaModal");
const lista = document.getElementById("listaLeyenda");

btn.onclick = () => {
    lista.innerHTML = "";
    for (let cod in biblioteca) {
        const sec = biblioteca[cod];
        const li = document.createElement("li");
        li.innerHTML = `<strong>${cod} - ${sec.nombre}</strong>`;
        if (Object.keys(sec.subsecciones).length > 0) {
            const ulSub = document.createElement("ul");
            for (let sub in sec.subsecciones) {
                const subLi = document.createElement("li");
                subLi.textContent = sub;
                ulSub.appendChild(subLi);
            }
            li.appendChild(ulSub);
        }
        lista.appendChild(li);
    }
    modal.style.display = "block";
};

document.getElementById("cerrarLeyenda").onclick = () => modal.style.display = "none";
window.onclick = e => { if(e.target == modal) modal.style.display = "none"; };
</script>

</body>
</html>
